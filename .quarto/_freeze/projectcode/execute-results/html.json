{
  "hash": "40338b8f6f2e786319b9a663a8ed7d7a",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Project Code\"\nsubtitle: \"Complete R Code for IBM HR Employee Attrition Analysis\"\nauthor: \"Rutvij & Sean Grieg\"\ndate: \"2025-12-13\"\nformat:\n  html:\n    toc: true\n    toc-depth: 2\n    code-fold: false\n    code-summary: \"Show Code\"\nexecute:\n  echo: true\n  warning: false\n  message: false\n  eval: false\n---\n\n\n\n\n\n# Setup and Libraries\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# =============================================================================\n# STAT 515 Final Project - IBM HR Employee Attrition Analysis\n# Team: Rutvij & Sean Greg\n# George Mason University | Fall 2024\n# =============================================================================\n\n# Load required libraries\nlibrary(readxl)\nlibrary(dplyr)\nlibrary(ggplot2)\nlibrary(tidyr)\nlibrary(knitr)\nlibrary(kableExtra)\nlibrary(scales)\nlibrary(corrplot)\nlibrary(car)\nlibrary(caret)\nlibrary(rpart)\nlibrary(rpart.plot)\nlibrary(randomForest)\nlibrary(glmnet)\nlibrary(pROC)\nlibrary(gridExtra)\n\n# Set seed for reproducibility\nset.seed(515)\n```\n:::\n\n\n\n\n\n# Data Loading and Preprocessing\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Load the dataset - try multiple possible paths\npossible_paths <- c(\n  \"data/HR_Data.xlsx\",\n  \"HR_Data.xlsx\",\n  \"./data/HR_Data.xlsx\",\n  \"./HR_Data.xlsx\"\n)\n\ndata_path <- NULL\nfor (p in possible_paths) {\n  if (file.exists(p)) {\n    data_path <- p\n    break\n  }\n}\n\nif (is.null(data_path)) {\n  stop(\"HR_Data.xlsx not found. Please ensure it's in the project folder or 'data' subfolder.\")\n}\n\nhr_data <- read_excel(data_path)\n\n# Examine structure\nglimpse(hr_data)\ndim(hr_data)\n\n# Create binary variables\nhr_data <- hr_data %>%\n  mutate(\n    Attrition_Binary = ifelse(Attrition == \"Yes\", 1, 0),\n    OverTime_Binary = ifelse(`Over Time` == \"Yes\", 1, 0)\n  )\n\n# Check class distribution\ntable(hr_data$Attrition)\nprop.table(table(hr_data$Attrition)) * 100\n\n# Calculate class weights for imbalanced data\nn_total <- nrow(hr_data)\nn_pos <- sum(hr_data$Attrition_Binary)\nn_neg <- n_total - n_pos\nweight_pos <- n_total / (2 * n_pos)\nweight_neg <- n_total / (2 * n_neg)\n\ncat(\"Class Weights:\\n\")\ncat(\"  Class 0 (No):\", weight_neg, \"\\n\")\ncat(\"  Class 1 (Yes):\", weight_pos, \"\\n\")\n```\n:::\n\n\n\n\n\n# Exploratory Data Analysis\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Attrition by categorical variables\nhr_data %>%\n  group_by(`Over Time`) %>%\n  summarise(\n    Total = n(),\n    Attrition = sum(Attrition_Binary),\n    Attrition_Rate = mean(Attrition_Binary) * 100\n  )\n\nhr_data %>%\n  group_by(Department) %>%\n  summarise(\n    Total = n(),\n    Attrition = sum(Attrition_Binary),\n    Attrition_Rate = mean(Attrition_Binary) * 100\n  )\n\n# Chi-square tests\nchi_overtime <- chisq.test(table(hr_data$`Over Time`, hr_data$Attrition))\nprint(chi_overtime)\n\nchi_dept <- chisq.test(table(hr_data$Department, hr_data$Attrition))\nprint(chi_dept)\n\n# T-tests for numeric variables\nt.test(hr_data$Age ~ hr_data$Attrition)\nt.test(hr_data$`Monthly Income` ~ hr_data$Attrition)\nt.test(hr_data$`Years At Company` ~ hr_data$Attrition)\n```\n:::\n\n\n\n\n\n# Research Question 1: Work-Life Imbalance Analysis\n\n## Decision Tree Model\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Prepare data for Q1\nq1_data <- hr_data %>%\n  select(Attrition_Binary, OverTime_Binary, `Distance From Home`, \n         `Work Life Balance`, `Years At Company`) %>%\n  rename(\n    DistanceFromHome = `Distance From Home`,\n    WorkLifeBalance = `Work Life Balance`,\n    YearsAtCompany = `Years At Company`\n  )\n\n# Train-test split\nset.seed(515)\ntrain_idx <- createDataPartition(q1_data$Attrition_Binary, p = 0.7, list = FALSE)\ntrain_data <- q1_data[train_idx, ]\ntest_data <- q1_data[-train_idx, ]\n\n# Fit decision tree\ndt_model <- rpart(\n  Attrition_Binary ~ OverTime_Binary + DistanceFromHome + WorkLifeBalance + YearsAtCompany,\n  data = train_data,\n  method = \"class\",\n  parms = list(prior = c(0.5, 0.5)),\n  control = rpart.control(maxdepth = 4, minsplit = 50, cp = 0.01)\n)\n\n# Print summary\nprintcp(dt_model)\n\n# Plot decision tree\nrpart.plot(dt_model, type = 4, extra = 104, fallen.leaves = TRUE,\n           main = \"Decision Tree: Work-Life Factors Predicting Attrition\")\n\n# Feature importance\ndt_importance <- dt_model$variable.importance / sum(dt_model$variable.importance)\nprint(sort(dt_importance, decreasing = TRUE))\n\n# Predictions and evaluation\npred_dt <- predict(dt_model, test_data, type = \"class\")\npred_prob_dt <- predict(dt_model, test_data, type = \"prob\")[, 2]\n\nconfusionMatrix(factor(pred_dt), factor(test_data$Attrition_Binary))\n\nroc_dt <- roc(test_data$Attrition_Binary, pred_prob_dt)\ncat(\"Decision Tree AUC:\", auc(roc_dt), \"\\n\")\n```\n:::\n\n\n\n\n\n## Logistic Regression with Interactions\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Create interaction terms\nhr_data <- hr_data %>%\n  mutate(\n    OT_x_WLB = OverTime_Binary * `Work Life Balance`,\n    OT_x_Distance = OverTime_Binary * `Distance From Home`,\n    OT_x_YearsAtCompany = OverTime_Binary * `Years At Company`\n  )\n\n# Fit logistic regression with interactions\nlogit_q1 <- glm(\n  Attrition_Binary ~ OverTime_Binary + `Distance From Home` + `Work Life Balance` + \n    `Years At Company` + OT_x_WLB + OT_x_Distance + OT_x_YearsAtCompany,\n  data = hr_data,\n  family = binomial(link = \"logit\")\n)\n\nsummary(logit_q1)\n\n# Odds ratios\nexp(coef(logit_q1))\nexp(confint(logit_q1))\n```\n:::\n\n\n\n\n\n## Random Forest Model\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Fit Random Forest\nrf_model <- randomForest(\n  factor(Attrition_Binary) ~ OverTime_Binary + DistanceFromHome + WorkLifeBalance + YearsAtCompany,\n  data = train_data,\n  ntree = 500,\n  mtry = 2,\n  classwt = c(1, 3),\n  importance = TRUE\n)\n\nprint(rf_model)\n\n# Variable importance\nimportance(rf_model)\nvarImpPlot(rf_model)\n\n# Predictions\npred_prob_rf <- predict(rf_model, test_data, type = \"prob\")[, 2]\nroc_rf <- roc(test_data$Attrition_Binary, pred_prob_rf)\ncat(\"Random Forest AUC:\", auc(roc_rf), \"\\n\")\n\n# ROC comparison\nplot(roc_dt, col = \"blue\", main = \"ROC Curves - Q1 Models\")\nplot(roc_rf, col = \"red\", add = TRUE)\nlegend(\"bottomright\", c(\"Decision Tree\", \"Random Forest\"), col = c(\"blue\", \"red\"), lwd = 2)\n```\n:::\n\n\n\n\n\n# Research Question 2: Career Stagnation Analysis\n\n## Weighted Logistic Regression\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Create weights\nweights <- ifelse(hr_data$Attrition_Binary == 1, weight_pos, weight_neg)\n\n# Fit weighted logistic regression\nlogit_q2 <- glm(\n  Attrition_Binary ~ `Years Since Last Promotion` + `Years In Current Role` +\n    `Monthly Income` + `Percent Salary Hike` + `Job Level`,\n  data = hr_data,\n  family = binomial(),\n  weights = weights\n)\n\nsummary(logit_q2)\n\n# Odds ratios\nexp(coef(logit_q2))\nexp(confint(logit_q2))\n```\n:::\n\n\n\n\n\n## LASSO Variable Selection\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Prepare feature matrix\nlasso_vars <- c(\"Years Since Last Promotion\", \"Years In Current Role\", \"Monthly Income\",\n                \"Percent Salary Hike\", \"Job Level\", \"Age\", \"Total Working Years\",\n                \"Years At Company\", \"Years With Curr Manager\", \"Distance From Home\",\n                \"Job Satisfaction\", \"Environment Satisfaction\", \"Work Life Balance\",\n                \"OverTime_Binary\", \"Num Companies Worked\", \"Stock Option Level\")\n\nX_lasso <- as.matrix(hr_data[, lasso_vars])\ny_lasso <- hr_data$Attrition_Binary\n\n# Cross-validated LASSO\ncv_lasso <- cv.glmnet(X_lasso, y_lasso, family = \"binomial\", alpha = 1, nfolds = 10)\n\n# Plot CV\nplot(cv_lasso)\n\n# Optimal lambda\ncat(\"Optimal Lambda:\", cv_lasso$lambda.min, \"\\n\")\n\n# Coefficients\nlasso_coefs <- coef(cv_lasso, s = \"lambda.min\")\nprint(lasso_coefs)\n```\n:::\n\n\n\n\n\n## ROC-AUC and Threshold Analysis\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Predictions\npred_probs_q2 <- predict(logit_q2, type = \"response\")\nroc_q2 <- roc(hr_data$Attrition_Binary, pred_probs_q2)\n\n# Optimal threshold (Youden's J)\ncoords_best <- coords(roc_q2, \"best\", ret = c(\"threshold\", \"sensitivity\", \"specificity\"))\ncat(\"Optimal Threshold:\", coords_best$threshold, \"\\n\")\ncat(\"Sensitivity:\", coords_best$sensitivity, \"\\n\")\ncat(\"Specificity:\", coords_best$specificity, \"\\n\")\n\n# ROC plot\nplot(roc_q2, main = \"ROC Curve - Career Stagnation Model\")\npoints(coords_best$specificity, coords_best$sensitivity, pch = 19, col = \"red\", cex = 2)\n\n# Classification at different thresholds\nfor (thresh in c(0.1, 0.2, 0.3, 0.4, 0.5, coords_best$threshold)) {\n  pred <- ifelse(pred_probs_q2 >= thresh, 1, 0)\n  sens <- mean(pred[hr_data$Attrition_Binary == 1] == 1)\n  spec <- mean(pred[hr_data$Attrition_Binary == 0] == 0)\n  acc <- mean(pred == hr_data$Attrition_Binary)\n  cat(sprintf(\"Threshold %.3f: Sens=%.3f, Spec=%.3f, Acc=%.3f\\n\", thresh, sens, spec, acc))\n}\n```\n:::\n\n\n\n\n\n# Research Question 3: Department-Stratified Analysis\n\n## VIF Analysis\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# VIF model\nvif_model <- lm(Attrition_Binary ~ `Job Satisfaction` + `Environment Satisfaction` +\n                  `Relationship Satisfaction` + `Work Life Balance` + \n                  `Job Involvement` + `Monthly Income` + Age,\n                data = hr_data)\n\nvif(vif_model)\n```\n:::\n\n\n\n\n\n## Stratified Logistic Regression\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Fit models for each department\ndepartments <- c(\"Sales\", \"R&D\", \"HR\")\n\nfor (dept in departments) {\n  cat(\"\\n========================================\\n\")\n  cat(\"DEPARTMENT:\", dept, \"\\n\")\n  cat(\"========================================\\n\")\n  \n  df_dept <- hr_data %>% filter(Department == dept)\n  \n  cat(\"Sample Size:\", nrow(df_dept), \"\\n\")\n  cat(\"Attrition Rate:\", round(mean(df_dept$Attrition_Binary) * 100, 1), \"%\\n\")\n  \n  model_dept <- glm(\n    Attrition_Binary ~ `Job Satisfaction` + `Environment Satisfaction` + `Relationship Satisfaction`,\n    data = df_dept,\n    family = binomial()\n  )\n  \n  print(summary(model_dept))\n  \n  cat(\"\\nOdds Ratios:\\n\")\n  print(exp(coef(model_dept)))\n  \n  # AUC\n  pred_probs <- predict(model_dept, type = \"response\")\n  roc_dept <- roc(df_dept$Attrition_Binary, pred_probs, quiet = TRUE)\n  cat(\"\\nAUC:\", round(auc(roc_dept), 3), \"\\n\")\n}\n```\n:::\n\n\n\n\n\n# Final Summary\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncat(\"=============================================\\n\")\ncat(\"FINAL SUMMARY\\n\")\ncat(\"=============================================\\n\")\ncat(\"Total Employees:\", nrow(hr_data), \"\\n\")\ncat(\"Attrition Rate:\", round(mean(hr_data$Attrition_Binary) * 100, 1), \"%\\n\")\ncat(\"\\nModel Performance:\\n\")\ncat(\"- Decision Tree AUC:\", round(auc(roc_dt), 3), \"\\n\")\ncat(\"- Random Forest AUC:\", round(auc(roc_rf), 3), \"\\n\")\ncat(\"- Weighted LR AUC:\", round(auc(roc_q2), 3), \"\\n\")\ncat(\"\\nKey Findings:\\n\")\ncat(\"1. OverTime is the strongest predictor of attrition\\n\")\ncat(\"2. Years Since Last Promotion increases risk by ~13% per year\\n\")\ncat(\"3. Satisfaction effects vary significantly by department\\n\")\n```\n:::\n\n\n\n\n\n# Session Info\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsessionInfo()\n```\n:::\n",
    "supporting": [
      "projectcode_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}